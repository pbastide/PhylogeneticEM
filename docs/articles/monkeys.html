<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analysis of the New World Monkeys dataset • PhylogeneticEM</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Analysis of the New World Monkeys dataset">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PhylogeneticEM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/tutorial.html">Tutorial</a>
</li>
<li>
  <a href="../articles/monkeys.html">New World Monkeys</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pbastide/PhylogeneticEM">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Analysis of the New World Monkeys dataset</h1>
                        <h4 class="author">Paul Bastide</h4>
            
            <h4 class="date">2020-02-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/pbastide/PhylogeneticEM/blob/master/vignettes/monkeys.Rmd"><code>vignettes/monkeys.Rmd</code></a></small>
      <div class="hidden name"><code>monkeys.Rmd</code></div>

    </div>

    
    
<div id="dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#dataset" class="anchor"></a>Dataset</h2>
<p>The dataset is taken from Aristide et al. (2016)<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>, and is embedded in the package. We can load and plot it easily.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(PhylogeneticEM)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(monkeys)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="../reference/params_BM.html">params_BM</a></span>(<span class="dt">p =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">     <span class="dt">data =</span> monkeys<span class="op">$</span>dat, <span class="dt">phylo =</span> monkeys<span class="op">$</span>phy,</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">     <span class="dt">show.tip.label =</span> <span class="ot">TRUE</span>, <span class="dt">cex =</span> <span class="fl">0.5</span>, <span class="dt">no.margin =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="monkeys_files/figure-html/data-1.png" width="672"></p>
<p>This <code>plot</code> function inherits from most of the optional arguments of the popular <code>ape</code> plot function (here for instance, the optional argument <code>show.tip.label</code> is used). Many other graphical parameters can be set by the user, so as to control the output of the function, see the manual pages for more details. The two traits (PCs) are represented on the right, each with its own scale. Plotting the data on the tree before analyzing it allows us to spot potential errors or outliers.</p>
</div>
<div id="inference" class="section level2">
<h2 class="hasAnchor">
<a href="#inference" class="anchor"></a>Inference</h2>
<p>By default, the inference is done on an automatically computed grid of 10 alpha values. To keep the computations down, we ask for a custom grid of only 4 values, but this number should be raised on a real application. The maximum number of shifts considered is here 10, and should be adapted considering the size of the tree.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/PhyloEM.html">PhyloEM</a></span>(<span class="dt">phylo =</span> monkeys<span class="op">$</span>phy,</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">               <span class="dt">Y_data =</span> monkeys<span class="op">$</span>dat,</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">               <span class="dt">process =</span> <span class="st">"scOU"</span>,                   <span class="co">## scalar OU model</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">               <span class="dt">random.root =</span> <span class="ot">TRUE</span>,                 <span class="co">## Root is stationary</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">               <span class="dt">stationary.root =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">               <span class="dt">nbr_alpha =</span> <span class="dv">4</span>,                      <span class="co">## Number of alpha values tested (should be raised)</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">               <span class="dt">K_max =</span> <span class="dv">10</span>,                         <span class="co">## Maximal number of shifts</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">               <span class="dt">parallel_alpha =</span> <span class="ot">TRUE</span>,              <span class="co">## This can be set to TRUE for</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">               <span class="dt">Ncores =</span> <span class="dv">2</span>)                         <span class="co">## parallel computations</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">res</a></code></pre></div>
<pre><code>## Result of the PhyloEM algorithm.
## Selected parameters by the default method:
## 2 dimensional scOU process with a random stationary root.
## 
## Root expectations:
## [1]  0.01552091 -0.01483439
## 
## Root variance:
##               [,1]          [,2]
## [1,]  3.636791e-04 -9.031817e-05
## [2,] -9.031817e-05  1.230269e-04
## 
## Process variance:
##               [,1]          [,2]
## [1,]  1.477757e-04 -3.669947e-05
## [2,] -3.669947e-05  4.999019e-05
## 
## Process selection strength:
##           [,1]      [,2]
## [1,] 0.2031677 0.0000000
## [2,] 0.0000000 0.2031677
## 
## Process root optimal values:
## [1]  0.01552091 -0.01483439
## 
## Shifts positions on branches: 4, 63, 46 
## Shifts values:
##                4           63         46
## [1,] -0.01812684 -0.093914264 0.08031859
## [2,]  0.05234025 -0.008148889 0.02527294
## 
## 
## 
## See help to see all plotting and handling functions.</code></pre>
<p>The result is stored in an object of class <code>PhyloEM</code>, which has several extractors available (see manual). The plot function shows solution selected by the default model selection method, but another one can be selected if needed. The same optional parameters can be used as before to control how the figure should look like.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(res)</a></code></pre></div>
<p><img src="monkeys_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
<p>Function <code>plot_criterion</code> shows the value of the default model selection criterion for each number of shifts.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="../reference/plot_criterion.html">plot_criterion</a></span>(res)</a></code></pre></div>
<p><img src="monkeys_files/figure-html/unnamed-chunk-2-1.png" width="384"></p>
<p>Here, the solution selected has three shifts. As shown above, the criterion is however a bit flat around its minimum, with a strange value for four shifts. This outlier is actually only due to the small grid on alpha taken in this toy example, and goes away for a finer analysis. To try and refine this result, one solution is to use a finer grid of alpha values. When a grid with 100 values is used, the solution with K=5 shifts is actually selected. We can plot it here for comparison.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(res, <span class="dt">params =</span> <span class="kw"><a href="../reference/params_process.html">params_process</a></span>(res, <span class="dt">K =</span> <span class="dv">5</span>))</a></code></pre></div>
<p><img src="monkeys_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
</div>
<div id="equivalent-solutions" class="section level2">
<h2 class="hasAnchor">
<a href="#equivalent-solutions" class="anchor"></a>Equivalent Solutions</h2>
<p>When plotting the solution with 5 shifts, the following warning pops up:</p>
<pre><code>## Warning in params_process.PhyloEM(res, K = 5): There are several equivalent
## solutions for this shift position.</code></pre>
<p>Indeed, the solution with 5 shifts has three equivalent shift allocations on the branches. These solutions can be found and plotted thanks to the function <code>equivalent_shifts</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="../reference/equivalent_shifts.html">equivalent_shifts</a></span>(monkeys<span class="op">$</span>phy, <span class="kw"><a href="../reference/params_process.html">params_process</a></span>(res, <span class="dt">K =</span> <span class="dv">5</span>)),</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">     <span class="dt">show_shifts_values =</span> <span class="ot">FALSE</span>, <span class="dt">shifts_cex =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<p><img src="monkeys_files/figure-html/unnamed-chunk-5-1.png" width="768"></p>
<p>Here, the three solutions are very similar, and just have to do with the two shifts appearing on two sister branches at the bottom of the tree. Note that all these solutions have 5 shifts, and define the same clustering of the tips in 6 groups. These configurations all have the same likelihood, and hence cannot be distinguished from the data.</p>
</div>
<div id="invariance-by-rotation" class="section level2">
<h2 class="hasAnchor">
<a href="#invariance-by-rotation" class="anchor"></a>Invariance by Rotation</h2>
<p>In theory, the method should not be affected by a rotation of the dataset (see Adams &amp; Collyer, 2018 <a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> for a review of this problem). However, because of some numerical issues, it is possible that the results vary a little bit. We can explore this behavior on this dataset.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co"># An arbitrary rotation</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">theta &lt;-<span class="st"> </span>pi<span class="op">/</span><span class="dv">4</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">rot &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span>(theta), <span class="op">-</span><span class="kw"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span>(theta), <span class="kw"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span>(theta), <span class="kw"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span>(theta)),</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">              <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">ncol =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb9-5" data-line-number="5"></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co"># Rotate data</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">Yrot &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(rot) <span class="op">%*%</span><span class="st"> </span>monkeys<span class="op">$</span>dat</a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(Yrot) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(monkeys<span class="op">$</span>dat)</a>
<a class="sourceLine" id="cb9-9" data-line-number="9"></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="co"># PhyloEM on rotated data</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11">res_rot &lt;-<span class="st"> </span><span class="kw"><a href="../reference/PhyloEM.html">PhyloEM</a></span>(<span class="dt">phylo =</span> monkeys<span class="op">$</span>phy,</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">                   <span class="dt">Y_data =</span> Yrot,                      <span class="co">## rotated data</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13">                   <span class="dt">process =</span> <span class="st">"scOU"</span>,                   </a>
<a class="sourceLine" id="cb9-14" data-line-number="14">                   <span class="dt">random.root =</span> <span class="ot">TRUE</span>,                 </a>
<a class="sourceLine" id="cb9-15" data-line-number="15">                   <span class="dt">stationary.root =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb9-16" data-line-number="16">                   <span class="dt">nbr_alpha =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb9-17" data-line-number="17">                   <span class="dt">K_max =</span> <span class="dv">10</span>,                         </a>
<a class="sourceLine" id="cb9-18" data-line-number="18">                   <span class="dt">parallel_alpha =</span> <span class="ot">TRUE</span>,              </a>
<a class="sourceLine" id="cb9-19" data-line-number="19">                   <span class="dt">Ncores =</span> <span class="dv">2</span>)                         </a></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(res_rot)</a></code></pre></div>
<p><img src="monkeys_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<p>At first sight, the solution looks very different. Indeed, when applied on the rotated dataset, <code>PhyloEM</code> selects for a solution with 7 shifts, instead of 3. But, if we look at the solution obtained for, say, 3 shifts, then they are identical:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(res, <span class="dt">params =</span> <span class="kw"><a href="../reference/params_process.html">params_process</a></span>(res, <span class="dt">K =</span> <span class="dv">3</span>), <span class="dt">no.margin =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(res_rot, <span class="dt">params =</span> <span class="kw"><a href="../reference/params_process.html">params_process</a></span>(res, <span class="dt">K =</span> <span class="dv">3</span>), <span class="dt">no.margin =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="monkeys_files/figure-html/unnamed-chunk-7-1.png" width="288"><img src="monkeys_files/figure-html/unnamed-chunk-7-2.png" width="288"></p>
<p>Looking a bit more closely at the outcome, we can see that the log likelihoods are actually very similar, except in a few places:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw"><a href="../reference/plot_criterion.html">plot_criterion</a></span>(res, <span class="st">"log_likelihood"</span>)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw"><a href="../reference/plot_criterion.html">plot_criterion</a></span>(res_rot, <span class="st">"log_likelihood"</span>, <span class="dt">pch =</span> <span class="st">"+"</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="monkeys_files/figure-html/unnamed-chunk-8-1.png" width="384"></p>
<p>What happens is that, for numerical reasons, the likelihood was slightly better optimized in some cases for one or the other datasets. This had an impact on the criterion used, that is based on the penalized likelihood. We can see it with a plot:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="../reference/plot_criterion.html">plot_criterion</a></span>(res)</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw"><a href="../reference/plot_criterion.html">plot_criterion</a></span>(res_rot, <span class="dt">pch =</span> <span class="st">"+"</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="monkeys_files/figure-html/unnamed-chunk-9-1.png" width="384"></p>
<p>But, as the two datasets should be equivalent, we don’t need to choose between the two runs. For each number of shifts, our only goal is to find the maximum likelihood solution. Hence, for each number of shifts, we can just take the best of the two solutions, that is the one that converged the best. This can be done with a dedicated function:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">res_merge &lt;-<span class="st"> </span><span class="kw"><a href="../reference/merge_rotations.html">merge_rotations</a></span>(res, res_rot)</a></code></pre></div>
<p>This function takes the first fit as a reference (here, with the original data). For a given number of shifts, when the second fit has a better likelihood, its solution is selected instead. Note that the parameters of the second fit are expressed in the rotated space, so, when selected, they need to be transformed back into the original space (which is done automatically by the function). The resulting solution has the highest likelihood possible for each value of K, and the model selection criterion can be applied to this new solution path.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw"><a href="../reference/plot_criterion.html">plot_criterion</a></span>(res_merge)</a></code></pre></div>
<p><img src="monkeys_files/figure-html/unnamed-chunk-10-1.png" width="384"></p>
<p>We can see here that the solution with 3 shifts is now selected again.</p>
<p>This merge function can be applied to more that two fits, as illustrated below.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co"># An other rotation</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2">theta &lt;-<span class="st"> </span>pi<span class="op">/</span><span class="dv">3</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3">rot2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span>(theta), <span class="op">-</span><span class="kw"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span>(theta), <span class="kw"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span>(theta), <span class="kw"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span>(theta)),</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">              <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">ncol =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb16-5" data-line-number="5"></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="co"># Rotate data</span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7">Yrot2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(rot2) <span class="op">%*%</span><span class="st"> </span>monkeys<span class="op">$</span>dat</a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(Yrot2) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(monkeys<span class="op">$</span>dat)</a>
<a class="sourceLine" id="cb16-9" data-line-number="9"></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="co"># PhyloEM on rotated data</span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11">res_rot2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/PhyloEM.html">PhyloEM</a></span>(<span class="dt">phylo =</span> monkeys<span class="op">$</span>phy,</a>
<a class="sourceLine" id="cb16-12" data-line-number="12">                   <span class="dt">Y_data =</span> Yrot2,</a>
<a class="sourceLine" id="cb16-13" data-line-number="13">                   <span class="dt">process =</span> <span class="st">"scOU"</span>,                   </a>
<a class="sourceLine" id="cb16-14" data-line-number="14">                   <span class="dt">random.root =</span> <span class="ot">TRUE</span>,                 </a>
<a class="sourceLine" id="cb16-15" data-line-number="15">                   <span class="dt">stationary.root =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb16-16" data-line-number="16">                   <span class="dt">nbr_alpha =</span> <span class="dv">2</span>,           <span class="co">## Note that this can also be different</span></a>
<a class="sourceLine" id="cb16-17" data-line-number="17">                   <span class="dt">K_max =</span> <span class="dv">10</span>,                        </a>
<a class="sourceLine" id="cb16-18" data-line-number="18">                   <span class="dt">parallel_alpha =</span> <span class="ot">TRUE</span>,            </a>
<a class="sourceLine" id="cb16-19" data-line-number="19">                   <span class="dt">Ncores =</span> <span class="dv">2</span>)                        </a>
<a class="sourceLine" id="cb16-20" data-line-number="20"></a>
<a class="sourceLine" id="cb16-21" data-line-number="21"><span class="co"># Merge</span></a>
<a class="sourceLine" id="cb16-22" data-line-number="22">res_merge2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/merge_rotations.html">merge_rotations</a></span>(res, res_rot, res_rot2)</a></code></pre></div>
<p>Here, this does not change the result.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw"><a href="../reference/plot_criterion.html">plot_criterion</a></span>(res_merge2)</a></code></pre></div>
<p><img src="monkeys_files/figure-html/unnamed-chunk-11-1.png" width="384"></p>
</div>
<div id="lizard-dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#lizard-dataset" class="anchor"></a>Lizard Dataset</h2>
<p>On the previous dataset, the introduction of rotations might appear a bit artificial. However, for some highly correlated datasets, such rotations might be needed. For instance, when studying the Anolis Lizard dataset (Mahler et al., 2013<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>), the application of several pseudo-orthonormalization techniques on the original dataset were needed to get a good maximum likelihood solution for all values of K. See Bastide et al. (2018)<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> for more details on this analysis.</p>
</div>
<div id="eb-model" class="section level2">
<h2 class="hasAnchor">
<a href="#eb-model" class="anchor"></a>EB model</h2>
<p>It can be shown that an Early Burst model (EB) is formally equivalent on an ultrametric tree to a non-shifted scOU with a negative alpha value. It is possible to include this model in the fit, by allowing “negative alpha” values in the function <code>PhyloEM</code>.</p>
<p>Note that, although the case with no shift has a clear interpretation (EB model), an scOU with shifts and a negative alpha can be hard to interpret, and is not always appropriate. One should hence be careful when using and interpreting such a model, and the use of this functionality is not encouraged for a first analysis.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">res_neg &lt;-<span class="st"> </span><span class="kw"><a href="../reference/PhyloEM.html">PhyloEM</a></span>(<span class="dt">phylo =</span> monkeys<span class="op">$</span>phy,</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">                   <span class="dt">Y_data =</span> monkeys<span class="op">$</span>dat,</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">                   <span class="dt">process =</span> <span class="st">"scOU"</span>,</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">                   <span class="dt">random.root =</span> <span class="ot">FALSE</span>,      <span class="co">## root needs to be fixed</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5">                   <span class="dt">K_max =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb18-6" data-line-number="6">                   <span class="dt">parallel_alpha =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb18-7" data-line-number="7">                   <span class="dt">Ncores =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb18-8" data-line-number="8">                   <span class="dt">nbr_alpha =</span> <span class="dv">4</span>,            <span class="co">## 2 negative, 2 positive (should be more)</span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9">                   <span class="dt">allow_negative =</span> <span class="ot">TRUE</span>)    <span class="co">## allow negative alpha in the grid</span></a></code></pre></div>
<p>We can extract the parameter of the fit with no shift, that is equivalent to an EB model:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw"><a href="../reference/params_process.html">params_process</a></span>(res_neg, <span class="dt">K =</span> <span class="dv">0</span>)</a></code></pre></div>
<pre><code>## Warning in params_process.PhyloEM(res_neg, K = 0): The 'selection strength' is
## negative. One should only look at the un-normalized values of the shifts. To do
## so, please call this function using 'rBM = TRUE'.</code></pre>
<pre><code>## Warning in check.selection.strength(process, ...): All the eigen values of the
## selection strengh do not have a strictly positive real part. That might cause
## some issue. Proceed with caution.</code></pre>
<pre><code>## 
## 2 dimensional scOU process with a fixed root.
## 
## 
## Root value:
## [1]  0.006507194 -0.003532184
## 
## Process variance:
##               [,1]          [,2]
## [1,]  5.370330e-05 -5.661713e-06
## [2,] -5.661713e-06  1.276595e-05
## 
## Process selection strength:
##             [,1]        [,2]
## [1,] -0.01316466  0.00000000
## [2,]  0.00000000 -0.01316466
## 
## Process root optimal values:
## [1]  0.006507194 -0.003532184
## 
## This process has no shift.</code></pre>
<p>The “selection strength” <span class="math inline">\(\alpha\)</span> is linked with the rate <span class="math inline">\(r\)</span> of the EB by the relation: <span class="math inline">\(r = 2\alpha\)</span>.</p>
<p>We can also plot the criterion for the model selection. Empirically, we found that the “BGHmlraw” criterion would behave a bit better in this configuration.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw"><a href="../reference/plot_criterion.html">plot_criterion</a></span>(res_neg, <span class="st">"BGHmlraw"</span>)</a></code></pre></div>
<p><img src="monkeys_files/figure-html/unnamed-chunk-13-1.png" width="384"></p>
<p>Here, a same solution with 7 shifts (and a positive alpha) is selected. Again, to keep computations to a minimum, we used a very coarse grid with only 4 values of alpha. On a finer grid, the same solution with 5 shifts is selected.</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Aristide, L., dos Reis, S. F., Machado, A. C., Lima, I., Lopes, R. T., &amp; Perez, S. I. (2016). Brain shape convergence in the adaptive radiation of New World monkeys. Proceedings of the National Academy of Sciences, 113(8), 2158–2163.<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>Adams, D. C., &amp; Collyer, M. L. (2018). Multivariate Phylogenetic Comparative Methods: Evaluations, Comparisons, and Recommendations. Systematic Biology, 67(1), 14–31.<a href="#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p>Mahler, D. L., Ingram, T., Revell, L. J., &amp; Losos, J. B. (2013). Exceptional Convergence on the Macroevolutionary Landscape in Island Lizard Radiations. Science, 341(6143), 292–295.<a href="#fnref3" class="footnote-back">↩</a></p></li>
<li id="fn4"><p>Bastide, P., Ané, C., Robin, S., &amp; Mariadassou, M. (2018). Inference of Adaptive Shifts for Multivariate Correlated Traits. Systematic Biology, 67(4), 662–680.<a href="#fnref4" class="footnote-back">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#dataset">Dataset</a></li>
      <li><a href="#inference">Inference</a></li>
      <li><a href="#equivalent-solutions">Equivalent Solutions</a></li>
      <li><a href="#invariance-by-rotation">Invariance by Rotation</a></li>
      <li><a href="#lizard-dataset">Lizard Dataset</a></li>
      <li><a href="#eb-model">EB model</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Paul Bastide.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
