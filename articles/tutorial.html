<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>An Introduction to the PhylogeneticEM Package • PhylogeneticEM</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="An Introduction to the PhylogeneticEM Package">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PhylogeneticEM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.8.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/tutorial.html">Tutorial</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/monkeys.html">New World Monkeys</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pbastide/PhylogeneticEM/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>An Introduction to the PhylogeneticEM Package</h1>
                        <h4 data-toc-skip class="author">Paul
Bastide</h4>
            
            <h4 data-toc-skip class="date">2025-09-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/pbastide/PhylogeneticEM/blob/master/vignettes/tutorial.Rmd" class="external-link"><code>vignettes/tutorial.Rmd</code></a></small>
      <div class="d-none name"><code>tutorial.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>PhylogeneticEM</code> package is designed to automatically
detect shifts in quantitative traits.</p>
<p>Simply load the package with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/pbastide/PhylogeneticEM" class="external-link">PhylogeneticEM</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulation-of-a-dataset">Simulation of a dataset<a class="anchor" aria-label="anchor" href="#simulation-of-a-dataset"></a>
</h2>
<p>To show how the functions work, let’s first simulate some traits with
known parameters.</p>
<p>We use function <code>sim.bd.taxa.age</code> from package
<code>TreeSim</code> to simulate a phylogenetic tree.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">17920902</span><span class="op">)</span></span>
<span><span class="va">ntaxa</span> <span class="op">=</span> <span class="fl">80</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu">TreeSim</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/TreeSim/man/sim.bd.taxa.age.html" class="external-link">sim.bd.taxa.age</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">ntaxa</span>, numbsim <span class="op">=</span> <span class="fl">1</span>, lambda <span class="op">=</span> <span class="fl">0.1</span>, mu <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                 age <span class="op">=</span> <span class="fl">1</span>, mrca <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p>We then choose a set of parameters, using function
<code>params_process</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/params_process.html">params_process</a></span><span class="op">(</span><span class="st">"OU"</span>,                             <span class="co">## Process</span></span>
<span>                         p <span class="op">=</span> <span class="fl">2</span>,                            <span class="co">## Dimension</span></span>
<span>                         variance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span>, <span class="co">## Rate matrix</span></span>
<span>                         selection.strength <span class="op">=</span> <span class="fl">3</span>,           <span class="co">## Selection Strength</span></span>
<span>                         random <span class="op">=</span> <span class="cn">TRUE</span>,                    <span class="co">## Root is random</span></span>
<span>                         stationary.root <span class="op">=</span> <span class="cn">TRUE</span>,           <span class="co">## Root is stationary</span></span>
<span>                         edges <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">81</span>, <span class="fl">124</span><span class="op">)</span>,           <span class="co">## Positions of the shifts</span></span>
<span>                         values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">4</span><span class="op">)</span>,           <span class="co">## Values of the shifts</span></span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="op">-</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="op">-</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Note that here, we took the selection strength to a scalar matrix,
but we could specify a full matrix. Also, we did not specified the
ancestral values of the optimum states: these are took to be
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>
by default.</p>
<p>The position of the shifts is specified through to the number of the
edge where it occurs. These can be saw using a standard
<code>plot</code> from package <code>ape</code>. Once the parameters are
constructed, we can check the position of the shifts by plotting
them:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">params</span>, phylo <span class="op">=</span> <span class="va">tree</span>, traits <span class="op">=</span> <span class="fl">1</span>, value_in_box <span class="op">=</span> <span class="cn">TRUE</span>, shifts_bg <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">params</span>, phylo <span class="op">=</span> <span class="va">tree</span>, traits <span class="op">=</span> <span class="fl">2</span>, value_in_box <span class="op">=</span> <span class="cn">TRUE</span>, shifts_bg <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-1-1.png" width="326.4"><img src="tutorial_files/figure-html/unnamed-chunk-1-2.png" width="326.4"></p>
<p>We can then simulate a process along the tree with these
parameters:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simul_process.html">simul_process</a></span><span class="op">(</span><span class="va">params</span>, <span class="va">tree</span><span class="op">)</span></span></code></pre></div>
<p>We can then extract a matrix of simulated data from this object:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract.html">extract</a></span><span class="op">(</span><span class="va">sim</span>,             <span class="co">## The simul_process object</span></span>
<span>                what <span class="op">=</span> <span class="st">"states"</span>, <span class="co">## We want the actual values</span></span>
<span>                where <span class="op">=</span> <span class="st">"tips"</span><span class="op">)</span>  <span class="co">## Only at the tips of the tree</span></span></code></pre></div>
<p>The column names of the matrix are set to the tip labels of the tree.
By default, the row names are left blank, but, for the sake of the
demonstration, let’s assume that the two traits are named “A” and
“B”:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can plot the simulated process on the tree to see what it
looks like:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">params</span>, phylo <span class="op">=</span> <span class="va">tree</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="inference">Inference<a class="anchor" aria-label="anchor" href="#inference"></a>
</h2>
<p>In this section, we take the traits as simulated by function
<code>simul_process</code>, and use function <code>PhyloEM</code> for
the inference of the parameters.</p>
<p>To make things more interesting, let’s assume that we have some
missing data:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nMiss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">ntaxa</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">*</span> <span class="fl">0.1</span><span class="op">)</span>                       <span class="co">## 10% of missing data</span></span>
<span><span class="va">miss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">ntaxa</span><span class="op">)</span>, <span class="va">nMiss</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co">## sample missing randomly</span></span>
<span><span class="va">chars</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">miss</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">+</span> <span class="fl">1</span>                          <span class="co">## Trace back rows and columns</span></span>
<span><span class="va">tips</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">miss</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span> <span class="fl">2</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nMiss</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">data</span><span class="op">[</span><span class="va">chars</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">tips</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>                       <span class="co">## Forget some values</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>By default, the inference is done on an automatically computed grid
of alpha values. Here, to keep the computations to a minimum, we will
only use
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>2</mn><annotation encoding="application/x-tex">2</annotation></semantics></math>
values for alpha, including the true value. In a true application
however, a grid with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>10</mn><annotation encoding="application/x-tex">10</annotation></semantics></math>
values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
is automatically chosen.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Grid on alpha</span></span>
<span><span class="va">alpha_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Run algorithm</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PhyloEM.html">PhyloEM</a></span><span class="op">(</span>phylo <span class="op">=</span> <span class="va">tree</span>,</span>
<span>               Y_data <span class="op">=</span> <span class="va">data</span>,</span>
<span>               process <span class="op">=</span> <span class="st">"scOU"</span>,                   <span class="co">## scalar OU model</span></span>
<span>               random.root <span class="op">=</span> <span class="cn">TRUE</span>,                 <span class="co">## Root is stationary (true model)</span></span>
<span>               stationary.root <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>               alpha <span class="op">=</span> <span class="va">alpha_grid</span>,                 <span class="co">## On a grid of alpha</span></span>
<span>               K_max <span class="op">=</span> <span class="fl">10</span>,                         <span class="co">## Maximal number of shifts</span></span>
<span>               parallel_alpha <span class="op">=</span> <span class="cn">TRUE</span>,              <span class="co">## This can be set to TRUE for</span></span>
<span>               Ncores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>                         <span class="co">## parallel computations</span></span>
<span><span class="va">res</span></span></code></pre></div>
<pre><code><span><span class="co">## Alpha 1</span></span></code></pre>
<pre><code><span><span class="co">##   |                                                                              |                                                                      |   0%  |                                                                              |======                                                                |   9%  |                                                                              |=============                                                         |  18%  |                                                                              |===================                                                   |  27%  |                                                                              |=========================                                             |  36%  |                                                                              |================================                                      |  45%  |                                                                              |======================================                                |  55%  |                                                                              |=============================================                         |  64%  |                                                                              |===================================================                   |  73%  |                                                                              |=========================================================             |  82%  |                                                                              |================================================================      |  91%  |                                                                              |======================================================================| 100%</span></span></code></pre>
<pre><code><span><span class="co">## Alpha 3</span></span></code></pre>
<pre><code><span><span class="co">##   |                                                                              |                                                                      |   0%  |                                                                              |======                                                                |   9%  |                                                                              |=============                                                         |  18%  |                                                                              |===================                                                   |  27%  |                                                                              |=========================                                             |  36%  |                                                                              |================================                                      |  45%  |                                                                              |======================================                                |  55%  |                                                                              |=============================================                         |  64%  |                                                                              |===================================================                   |  73%  |                                                                              |=========================================================             |  82%  |                                                                              |================================================================      |  91%  |                                                                              |======================================================================| 100%</span></span></code></pre>
<pre><code><span><span class="co">## Result of the PhyloEM algorithm.</span></span>
<span><span class="co">## Selected parameters by the default method:</span></span>
<span><span class="co">## 2 dimensional scOU process with a random stationary root.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Root expectations:</span></span>
<span><span class="co">##           A           B </span></span>
<span><span class="co">## -0.03037692 -0.16473636 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Root variance:</span></span>
<span><span class="co">##            A          B</span></span>
<span><span class="co">## A 0.16133807 0.08997021</span></span>
<span><span class="co">## B 0.08997021 0.17555865</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Process variance:</span></span>
<span><span class="co">##           A         B</span></span>
<span><span class="co">## A 0.9680284 0.5398213</span></span>
<span><span class="co">## B 0.5398213 1.0533519</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Process selection strength:</span></span>
<span><span class="co">##   A B</span></span>
<span><span class="co">## A 3 0</span></span>
<span><span class="co">## B 0 3</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Process root optimal values:</span></span>
<span><span class="co">##           A           B </span></span>
<span><span class="co">## -0.03037692 -0.16473636 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Shifts positions on branches: 124, 81, 16 </span></span>
<span><span class="co">## Shifts values:</span></span>
<span><span class="co">##         124        81       16</span></span>
<span><span class="co">## A  4.840772 -4.044706 5.156022</span></span>
<span><span class="co">## B -2.837178 -4.843109 4.268610</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## See help to see all plotting and handling functions.</span></span></code></pre>
<p>The fitted object contains the inferred parameters for every values
of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>,
as well as the parameters selected by the various model selection
criteria.</p>
<p>Here, we can see that the original shifts were recovered by the model
selection procedure. We can plot the obtained solution, as shown below.
The inferred states a the tips are shown in dotted lines. Notice that
they are coherent with the positions of the shifts that we found.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<p>The function above automatically plots the solution selected by the
model selection criterion. We can plot this criterion, to see whether
the solution selected is a clear minimum.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_criterion.html">plot_criterion</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-5-1.png" width="384"></p>
<p>Here, the criterion behaves rather well, and the solution for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">K=3</annotation></semantics></math>
seems to be a good choice.</p>
<p>Above, we plotted the solution given by the LINselect method (the
default). But we might want to see the solution given by another
selection method, such as the slope heuristic. In that case, we just
need to run:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span>, params <span class="op">=</span> <span class="fu"><a href="../reference/params_process.html">params_process</a></span><span class="op">(</span><span class="va">res</span>, method.selection <span class="op">=</span> <span class="st">"DDSE"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>where we extracted the parameters with the method
<code>params_process</code>. Here, the results are the same.</p>
<p>We can also extract the solution for a given number of shifts and/or
a given value of alpha. For instance, we can see that in this simple
case, the inferred position of the shifts is robust to the value of the
selection strength:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span>, params <span class="op">=</span> <span class="fu"><a href="../reference/params_process.html">params_process</a></span><span class="op">(</span><span class="va">res</span>, K <span class="op">=</span> <span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>The inferred shifts values however are quite different:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/params_process.html">params_process</a></span><span class="op">(</span><span class="va">res</span>, K <span class="op">=</span> <span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">shifts</span></span></code></pre></div>
<pre><code><span><span class="co">## $edges</span></span>
<span><span class="co">## [1] 124  81  16</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $values</span></span>
<span><span class="co">##        [,1]      [,2]     [,3]</span></span>
<span><span class="co">## A  8.112461 -6.319463 9.170695</span></span>
<span><span class="co">## B -4.904349 -7.624018 7.856664</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $relativeTimes</span></span>
<span><span class="co">## [1] 0 0 0</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/params_process.html">params_process</a></span><span class="op">(</span><span class="va">res</span>, K <span class="op">=</span> <span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">$</span><span class="va">shifts</span></span></code></pre></div>
<pre><code><span><span class="co">## $edges</span></span>
<span><span class="co">## [1] 124  81  16</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $values</span></span>
<span><span class="co">##        [,1]      [,2]     [,3]</span></span>
<span><span class="co">## A  4.840772 -4.044706 5.156022</span></span>
<span><span class="co">## B -2.837178 -4.843109 4.268610</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $relativeTimes</span></span>
<span><span class="co">## [1] 0 0 0</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="equivalent-solutions">Equivalent Solutions<a class="anchor" aria-label="anchor" href="#equivalent-solutions"></a>
</h2>
<p>When there are too many shifts, the solution might not be
identifiable. For instance here, if we take the (degenerate) solution
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>6</mn><annotation encoding="application/x-tex">6</annotation></semantics></math>
shifts, we get this warning:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params_6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/params_process.html">params_process</a></span><span class="op">(</span><span class="va">res</span>, K <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in params_process.PhyloEM(res, K = 6): There are several equivalent</span></span>
<span><span class="co">## solutions for this shift position.</span></span></code></pre>
<p>And we can plot all the equivalent shifts allocations:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/equivalent_shifts.html">equivalent_shifts</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">params_6</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-10-1.png" width="768"></p>
<p>the default only shows the shifts values for the first trait.</p>
<!-- Vignettes are long form documentation commonly included in packages. Because they are part of the distribution of the package, they need to be as compact as possible. The `html_vignette` output type provides a custom style sheet (and tweaks some options) to ensure that the resulting html is as small as possible. The `html_vignette` format: -->
<!-- - Never uses retina figures -->
<!-- - Has a smaller default figure size -->
<!-- - Uses a custom CSS stylesheet instead of the default Twitter Bootstrap style -->
<!-- ## Vignette Info -->
<!-- Note the various macros within the `vignette` section of the metadata block above. These are required in order to instruct R how to build the vignette. Note that you should change the `title` field and the `\VignetteIndexEntry` to match the title of your vignette. -->
<!-- ## Styles -->
<!-- The `html_vignette` template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows: -->
<!--     output:  -->
<!--       rmarkdown::html_vignette: -->
<!--         css: mystyles.css -->
<!-- ## Figures -->
<!-- The figure sizes have been customised so that you can easily put two images side-by-side.  -->
<!-- ```{r, fig.show='hold'} -->
<!-- plot(1:10) -->
<!-- plot(10:1) -->
<!-- ``` -->
<!-- You can enable figure captions by `fig_caption: yes` in YAML: -->
<!--     output: -->
<!--       rmarkdown::html_vignette: -->
<!--         fig_caption: yes -->
<!-- Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**. -->
<!-- ## More Examples -->
<!-- You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`. -->
<!-- ```{r, echo=FALSE, results='asis'} -->
<!-- knitr::kable(head(mtcars, 10)) -->
<!-- ``` -->
<!-- Also a quote using `>`: -->
<!-- > "He who gives up [code] safety for [code] speed deserves neither." -->
<!-- ([via](https://twitter.com/hadleywickham/status/504368538874703872)) -->
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Paul Bastide.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
